# åœ°å›¾æ ‡æ³¨ç³»ç»Ÿ

åŸºäºç™¾åº¦åœ°å›¾çš„è½»é‡çº§åœ°å€æ ‡æ³¨ä¸å¯è§†åŒ–ç³»ç»Ÿï¼Œæ”¯æŒæ‰¹é‡å¯¼å…¥Excelæ•°æ®å¹¶åœ¨åœ°å›¾ä¸Šå±•ç¤ºæ ‡è®°ç‚¹ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ“ **æ‰¹é‡åœ°å€æ ‡æ³¨**ï¼šæ”¯æŒExcelæ–‡ä»¶æ‰¹é‡å¯¼å…¥åœ°å€æ•°æ®
- ğŸ—ºï¸ **åœ°å›¾å¯è§†åŒ–**ï¼šåŸºäºç™¾åº¦åœ°å›¾APIå±•ç¤ºæ‰€æœ‰åœ°å€æ ‡è®°
- ğŸ¯ **åœ°ç†ç¼–ç **ï¼šè‡ªåŠ¨å°†åœ°å€è½¬æ¢ä¸ºåœ°å›¾åæ ‡
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨SQLiteè½»é‡çº§æ•°æ®åº“å­˜å‚¨
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¼€ç®±å³ç”¨
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯è®¿é—®

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯
- HTML5 + CSS3 + JavaScript
- ç™¾åº¦åœ°å›¾JavaScript API v3.0
- å“åº”å¼å¸ƒå±€è®¾è®¡

### åç«¯
- Node.js + Express
- SQLiteæ•°æ®åº“ï¼ˆbetter-sqlite3ï¼‰
- Multeræ–‡ä»¶ä¸Šä¼ 
- xlsx Excelæ–‡ä»¶è§£æ

### éƒ¨ç½²
- Docker + Docker Compose
- Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Node.js 18+
- Docker & Docker Composeï¼ˆå®¹å™¨åŒ–éƒ¨ç½²ï¼‰
- ç™¾åº¦åœ°å›¾APIå¯†é’¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–ç™¾åº¦åœ°å›¾APIå¯†é’¥

è®¿é—® [ç™¾åº¦åœ°å›¾å¼€æ”¾å¹³å°](https://lbsyun.baidu.com/apiconsole/key) ç”³è¯·APIå¯†é’¥

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„ç™¾åº¦åœ°å›¾APIå¯†é’¥ï¼š

```env
PORT=3000
LOG_LEVEL=info
LOG_FILE=./logs/app.log

# ç™¾åº¦åœ°å›¾APIé…ç½®
BAIDU_MAP_API_KEY=your_baidu_map_api_key_here
```

### 3. ä½¿ç”¨Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

æœåŠ¡å°†åœ¨ `http://localhost:18000` å¯åŠ¨

### 4. æœ¬åœ°å¼€å‘éƒ¨ç½²

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨æœåŠ¡
npm start

# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev
```

æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨

## ğŸ“– ä½¿ç”¨æŒ‡å—

### Excelæ–‡ä»¶æ ¼å¼

Excelæ–‡ä»¶éœ€åŒ…å«ä»¥ä¸‹åˆ—ï¼ˆè¡¨å¤´åç§°å¿…é¡»åŒ¹é…ï¼‰ï¼š

| åˆ—å | è¯´æ˜ | å¿…å¡« | ç¤ºä¾‹ |
|------|------|------|------|
| name | åç§° | å¦ | æ­å·è¥¿æ¹–å›½å®¾é¦† |
| address | åœ°å€ | æ˜¯ | æ­å·å¸‚è¥¿æ¹–åŒºæ¨å…¬å ¤18å· |
| type | ç±»å‹ | å¦ | è±ªåæ¹–æ™¯å¤§åºŠæˆ¿ |
| lng | ç»åº¦ | å¦ | 120.130953 |
| lat | çº¬åº¦ | å¦ | 30.246273 |

**ç¤ºä¾‹Excelæ•°æ®ï¼š**

```
| name         | address              | type       | lng        | lat       |
|--------------|----------------------|------------|------------|----------|
| è¥¿æ¹–å›½å®¾é¦†    | æ­å·å¸‚è¥¿æ¹–åŒºæ¨å…¬å ¤18å· | é…’åº—       | 120.130953 | 30.246273 |
| é¦™æ ¼é‡Œæ‹‰é¥­åº—  | æ­å·å¸‚è¥¿æ¹–åŒºåŒ—å±±è·¯78å· | é…’åº—       | 120.147835 | 30.261654 |
```

### æ“ä½œæ­¥éª¤

1. **ä¸Šä¼ Excelæ–‡ä»¶**ï¼šç‚¹å‡»"ä¸Šä¼ æ–‡ä»¶"æŒ‰é’®ï¼Œé€‰æ‹©åŒ…å«åœ°å€æ•°æ®çš„Excelæ–‡ä»¶
2. **è‡ªåŠ¨è§£æ**ï¼šç³»ç»Ÿè‡ªåŠ¨è§£æExcelå¹¶æå–åœ°å€ä¿¡æ¯
3. **åœ°ç†ç¼–ç **ï¼šç³»ç»Ÿè°ƒç”¨ç™¾åº¦åœ°å›¾APIå°†åœ°å€è½¬æ¢ä¸ºåæ ‡ï¼ˆå¦‚æœExcelä¸­æœªæä¾›åæ ‡ï¼‰
4. **åœ°å›¾å±•ç¤º**ï¼šæ‰€æœ‰åœ°å€è‡ªåŠ¨æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Šï¼Œå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
5. **æ•°æ®æŒä¹…åŒ–**ï¼šåœ°å€æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°SQLiteæ•°æ®åº“

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ server.js              # ExpressæœåŠ¡å™¨ä¸»æ–‡ä»¶
â”œâ”€â”€ config.js              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ models/
â”‚   â””â”€â”€ db.js             # SQLiteæ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.js         # æ—¥å¿—å·¥å…·
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html        # å‰ç«¯é¡µé¢
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css     # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ main.js       # å‰ç«¯é€»è¾‘
â”œâ”€â”€ uploads/              # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ data/                 # SQLiteæ•°æ®åº“æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docker-compose.yml    # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile            # Dockeré•œåƒé…ç½®
â”œâ”€â”€ .dockerignore        # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .gitignore           # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ package.json         # NPMä¾èµ–é…ç½®
```

## ğŸ”§ APIæ¥å£

### ä¸Šä¼ Excelæ–‡ä»¶

```http
POST /upload
Content-Type: multipart/form-data

file: Excelæ–‡ä»¶
```

**å“åº”ï¼š**

```json
{
  "success": true,
  "data": [
    {
      "name": "è¥¿æ¹–å›½å®¾é¦†",
      "address": "æ­å·å¸‚è¥¿æ¹–åŒºæ¨å…¬å ¤18å·",
      "type": "é…’åº—",
      "lng": 120.130953,
      "lat": 30.246273
    }
  ]
}
```

### è·å–æ‰€æœ‰åœ°å€

```http
GET /addresses
```

**å“åº”ï¼š**

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "è¥¿æ¹–å›½å®¾é¦†",
      "address": "æ­å·å¸‚è¥¿æ¹–åŒºæ¨å…¬å ¤18å·",
      "type": "é…’åº—",
      "lng": 120.130953,
      "lat": 30.246273,
      "created_at": "2024-01-09T10:30:00.000Z",
      "updated_at": "2024-01-09T10:30:00.000Z"
    }
  ]
}
```

### è·å–ç™¾åº¦åœ°å›¾APIå¯†é’¥

```http
GET /api/map-key
```

**å“åº”ï¼š**

```json
{
  "success": true,
  "apiKey": "your_api_key"
}
```

### å¥åº·æ£€æŸ¥

```http
GET /health
```

**å“åº”ï¼š**

```json
{
  "status": "ok",
  "database": "sqlite",
  "records": 10
}
```

## ğŸ³ Dockeréƒ¨ç½²è¯¦è§£

### æ„å»ºé•œåƒ

```bash
docker build -t map-annotation .
```

### è¿è¡Œå®¹å™¨

```bash
docker run -d \
  -p 18000:3000 \
  -e BAIDU_MAP_API_KEY=your_api_key \
  -v $(pwd)/uploads:/app/uploads \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/logs:/app/logs \
  --name map-annotation \
  map-annotation
```

### æ•°æ®æŒä¹…åŒ–

Docker volumesæŒ‚è½½ä»¥ä¸‹ç›®å½•å®ç°æ•°æ®æŒä¹…åŒ–ï¼š

- `./uploads` - ä¸Šä¼ çš„Excelæ–‡ä»¶
- `./data` - SQLiteæ•°æ®åº“æ–‡ä»¶
- `./logs` - åº”ç”¨æ—¥å¿—

## ğŸ“Š æ•°æ®åº“

### SQLiteæ•°æ®åº“ç»“æ„

**addressesè¡¨ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼ˆè‡ªå¢ï¼‰ |
| name | TEXT | åç§° |
| address | TEXT | åœ°å€ï¼ˆå¿…å¡«ï¼‰ |
| type | TEXT | ç±»å‹ |
| lng | REAL | ç»åº¦ |
| lat | REAL | çº¬åº¦ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼š**
- `idx_address` - åœ°å€ç´¢å¼•
- `idx_created_at` - åˆ›å»ºæ—¶é—´ç´¢å¼•

## ğŸ” å®‰å…¨æ€§

- æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
- è¾“å…¥æ•°æ®éªŒè¯
- APIå¯†é’¥ç¯å¢ƒå˜é‡éš”ç¦»
- Dockerå®¹å™¨éš”ç¦»è¿è¡Œ

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### åœ°å›¾æ— æ³•æ˜¾ç¤º

1. æ£€æŸ¥ç™¾åº¦åœ°å›¾APIå¯†é’¥æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤APIå¯†é’¥çš„æœåŠ¡æƒé™åŒ…å«"JavaScript API"
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### åœ°å€æ— æ³•æ ‡æ³¨

1. ç¡®è®¤åœ°å€æ ¼å¼æ­£ç¡®ï¼ˆåŒ…å«çœå¸‚åŒºè¯¦ç»†ä¿¡æ¯ï¼‰
2. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼š`docker-compose logs -f`

### æ•°æ®åº“é—®é¢˜

1. ç¡®è®¤dataç›®å½•å­˜åœ¨ä¸”æœ‰å†™æƒé™
2. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶ï¼š`ls -la data/`
3. æŸ¥çœ‹SQLiteæ•°æ®åº“ï¼š`sqlite3 data/map_annotation.db "SELECT * FROM addresses"`

## ğŸ“ å¼€å‘è¯´æ˜

### ä¾èµ–ç®¡ç†

```bash
# å®‰è£…ä¾èµ–
npm install

# æ›´æ–°ä¾èµ–
npm update

# å®¡è®¡å®‰å…¨é—®é¢˜
npm audit fix
```

### æ—¥å¿—çº§åˆ«

æ”¯æŒçš„æ—¥å¿—çº§åˆ«ï¼š`error`, `warn`, `info`, `debug`

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```env
LOG_LEVEL=info
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³é“¾æ¥

- [ç™¾åº¦åœ°å›¾å¼€æ”¾å¹³å°](https://lbsyun.baidu.com/)
- [ç™¾åº¦åœ°å›¾JavaScript APIæ–‡æ¡£](https://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference_3_0.html)
- [Expressæ¡†æ¶](https://expressjs.com/)
- [SQLite](https://www.sqlite.org/)
- [better-sqlite3](https://github.com/WiseLibs/better-sqlite3)

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡GitHub Issuesè”ç³»ã€‚
